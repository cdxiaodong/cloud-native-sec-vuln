{
	"cvss": {
		"score": 6.8,
		"vector_string": "CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:N"
	},
	"cwes": [
		{
			"cwe_id": "CWE-311",
			"name": "Missing Encryption of Sensitive Data"
		}
	],
	"ghsa_id": "GHSA-vrph-m5jj-c46c",
	"summary": "Weave CNI password is not configured when a cluster is created from an RKE template",
	"description": "### Impact\r\n\r\nThis vulnerability only affects customers using [Weave](https://rancher.com/docs/rancher/v2.6/en/faq/networking/cni-providers/#weave) CNI (Container Network Interface) when configured through [RKE templates](https://rancher.com/docs/rancher/v2.6/en/admin-settings/rke-templates/).\r\n\r\nA flaw was discovered in Rancher versions from 2.5.0 up to and including 2.5.13 and from 2.6.0 up to and including 2.6.4, where a UI (user interface) issue with RKE templates does not include a value for the Weave password when Weave is chosen as the CNI.\r\n\r\nIf a cluster is created based on the mentioned template and Weave is configured as the CNI, no password will be created for [network encryption](https://www.weave.works/docs/net/latest/tasks/manage/security-untrusted-networks/) in Weave, therefore network traffic in the cluster will be sent unencrypted.\r\n\r\nThis issue does not happen when a cluster, with Weave configured as CNI, is created without using an RKE template.\r\n\r\nThe impact of this vulnerability is higher when nodes on the cluster are on different locations and communicate with one another through the Internet, where monitoring (sniffing) of the network traffic by third-party entities can be more easily achieved.\r\n\r\n### Patches\r\n\r\nPatched versions include releases 2.5.14, 2.6.5 and later versions of Rancher. Besides upgrading to a Rancher patched version, the workarounds listed below must be applied in order for Weave to properly encrypt the network traffic.\r\n\r\n### Workarounds\r\n\r\n1. A manual password can be set in Weave by directly editing Weave's DaemonSet on the affected cluster to add the `WEAVE_PASSWORD` environment variable together with the a value for the password.\r\n\r\n```shell\r\n$ kubectl -n kube-system edit ds weave-net\r\n```\r\n```yaml\r\n\u003csnipped\u003e\r\n      containers:\r\n      - command:\r\n        - /home/weave/launch.sh\r\n        env:\r\n        - name: INIT_CONTAINER\r\n          value: \"true\"\r\n        - name: HOSTNAME\r\n          valueFrom:\r\n            fieldRef:\r\n              apiVersion: v1\r\n              fieldPath: spec.nodeName\r\n        - name: IPALLOC_RANGE\r\n          value: \u003cIP allocation range\u003e\r\n        - name: WEAVE_PASSWORD\r\n          value: \"insert strong secret password here\"\r\n        image: \u003cWeave image\u003e\r\n\u003csnipped\u003e\r\n```\r\n2. A new [RKE template revision](https://rancher.com/docs/rancher/v2.6/en/admin-settings/rke-templates/creating-and-revising/) must be created in order to properly generate the Weave password on new clusters.\r\n\r\n**Notes**\r\n\r\n1. In order to provide protection against brute-force attacks, that might break the network encryption, a strong password must be generated for the workaround. Weave's documentation provides recommendations for generating a [strong password](https://www.weave.works/docs/net/latest/tasks/manage/security-untrusted-networks/).\r\n\r\n2. Manually generating the password for the workaround is only needed on affected versions of Rancher. This step is not needed when creating new RKE templates on patched versions of Rancher.\r\n\r\n### For more information\r\n\r\nIf you have any questions or comments about this advisory:\r\n\r\n* Reach out to [SUSE Rancher Security team](https://github.com/rancher/rancher/security/policy) for security related inquiries.\r\n* Open an issue in [Rancher](https://github.com/rancher/rancher/issues/new/choose) repository.\r\n* Verify SUSE Rancher [support matrix](https://www.suse.com/suse-rancher/support-matrix/all-supported-versions/) and [product support lifecycle](https://www.suse.com/lifecycle/).",
	"severity": "medium",
	"identifiers": [
		{
			"value": "GHSA-vrph-m5jj-c46c",
			"type": "GHSA"
		},
		{
			"value": "CVE-2022-21951",
			"type": "CVE"
		}
	],
	"published_at": "2022-05-24T19:44:05Z",
	"updated_at": "2022-05-24T19:44:05Z",
	"vulnerabilities": [
		{
			"package": {
				"ecosystem": "rancher",
				"name": "Rancher"
			},
			"vulnerable_version_range": "Up to and including 2.5.13 and 2.6.4",
			"patched_versions": "2.5.14, 2.6.5 and later releases"
		}
	],
	"cve_id": "CVE-2022-21951",
	"url": "https://api.github.com/repos/rancher/rancher/security-advisories/GHSA-vrph-m5jj-c46c",
	"html_url": "https://github.com/rancher/rancher/security/advisories/GHSA-vrph-m5jj-c46c",
	"publisher": {
		"login": "maxsokolovsky",
		"id": 17733533,
		"node_id": "MDQ6VXNlcjE3NzMzNTMz",
		"avatar_url": "https://avatars.githubusercontent.com/u/17733533?v=4",
		"html_url": "https://github.com/maxsokolovsky",
		"gravatar_id": "",
		"type": "User",
		"site_admin": false,
		"url": "https://api.github.com/users/maxsokolovsky",
		"events_url": "https://api.github.com/users/maxsokolovsky/events{/privacy}",
		"following_url": "https://api.github.com/users/maxsokolovsky/following{/other_user}",
		"followers_url": "https://api.github.com/users/maxsokolovsky/followers",
		"gists_url": "https://api.github.com/users/maxsokolovsky/gists{/gist_id}",
		"organizations_url": "https://api.github.com/users/maxsokolovsky/orgs",
		"received_events_url": "https://api.github.com/users/maxsokolovsky/received_events",
		"repos_url": "https://api.github.com/users/maxsokolovsky/repos",
		"starred_url": "https://api.github.com/users/maxsokolovsky/starred{/owner}{/repo}",
		"subscriptions_url": "https://api.github.com/users/maxsokolovsky/subscriptions"
	},
	"state": "published",
	"cwe_ids": [
		"CWE-311"
	]
}